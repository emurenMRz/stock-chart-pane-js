var t={d:(e,i)=>{for(var s in i)t.o(i,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:i[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};t.d(e,{Z:()=>l});class i{#t=null;constructor(t){this.#t=new Array(t),this.#t.fill(-1)}push(t){return this.#t.push(t),this.#t.shift(),-1!=this.#t[0]}calc(){return this.#t.reduce(((t,e)=>t+e))/this.#t.length}}class s{#e=[];#i=0;#s=0;#h=0;constructor(t=14){this.#s=t}get value(){return this.#h}push(t){if(t<0)return!1;if(0==this.#i)return this.#i=t,!1;if(this.#e.push(t-this.#i),this.#i=t,this.#e.length<this.#s)return!1;let e=0,i=0;for(const t of this.#e)t>=0?e+=t:i+=t;return i=-i,this.#e.shift(),e+i!=0&&(this.#h=e/(e+i)*100|0,!0)}}class h{#a=0;#n=0;#r=0;#o=!0;#l=0;#d=0;#c=0;#p=0;constructor(t){this.#l=t}calc(t,e,i){if(this.#d||this.#c||this.#p)if(this.#n){const i=this.#o,s=this.#r;this.#o=this.#o?this.#a<t:this.#a<e,this.#r=this.#o?this.#a>t?t:Math.max(e,this.#r):this.#a<e?e:Math.min(t,this.#r),this.#o==i?(s!=this.#r&&this.#n<.2&&(this.#n+=this.#l),this.#a+=this.#n*(this.#r-this.#a)):(this.#n=this.#l,this.#a=s)}else this.#n=this.#l,this.#o=i>this.#p,this.#o?(this.#r=e,this.#a=this.#c):(this.#r=t,this.#a=this.#d);return this.#d=t,this.#c=e,this.#p=i,this.#a}getTrend(){return this.#o}}class a{#m=null;#g=0;#u=0;constructor(t,e){this.#g=t,this.#u=e,this.#m=new ImageData(this.#g,this.#u)}get imageData(){return this.#m}get width(){return this.#g}get height(){return this.#u}drawLine(t,e,i,s,h=255){const a=new Uint32Array(this.#m.data.buffer),n=this.#m.width;if(t|=0,e|=0,i|=0,s|=0,h=this.#w(h),e==s){const s=t<i?t:i,r=(t<i?i:t)-s;let o=e*n+s;for(let t=0;t<=r;++t,++o)a[o]=h}else if(t==i){const i=e<s?e:s,r=(e<s?s:e)-i;let o=i*n+t;for(let t=0;t<=r;++t,o+=n)a[o]=h}else{const r=Math.abs(i-t),o=Math.abs(s-e),l=t<i?1:-1,d=e<s?1:-1;let c=r-o;for(;a[e*n+t]=h,t!=i||e!=s;){const i=c<<1;i>-o&&(c-=o,t+=l),i<r&&(c+=r,e+=d)}}}drawRect(t,e,i,s,h=255){const a=new Uint32Array(this.#m.data.buffer),n=this.#m.width;t|=0,e|=0,i|=0,s|=0,h=this.#w(h);let r=e*n+t;for(let t=s;t>0;--t,r+=n)for(let t=0;t<i;++t)a[r+t]=h}clear(t=0){const e=new Uint32Array(this.#m.data.buffer);t=this.#w(t);for(let i=0;i<e.length;++i)e[i]=t}rectAlpha(t,e,i,s,h){const a=this.#m.data,n=this.#m.width<<2;i=(0|i)<<2;let r=(e|=0)*n+((t|=0)<<2);for(let t=s|=0;t>0;--t,r+=n)for(let t=0;t<i;t+=4){const e=r+t+3,i=a[e];i&&(a[e]=i*h|0)}}#w(t){return(t>>0&255)<<24|(t>>8&255)<<16|(t>>16&255)<<8|t>>24&255}}function n(t){return(t+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")}class r{static PRICE_MODE=0;static PERCENTAGE_CHANGE_MODE=1;#C=r.PRICE_MODE;#v=null;#x=null;#y=0;#R=10;#f=0;#L=0;#P=0;#b=0;#A=0;#E=0;#S=0;#D=[];#T=0;#I=0;#V=0;#M=void 0;#q={averageCost:12910464,monthlySeparator:64,horizonLine:128,text:255,candle:{up:4278190335,down:10506495},volume:4294902015,MA:[8454143,4286578943],parabolic:{up:4287168511,down:2298448127},RSI:{center:1077952767,support:538976511,line:255},rate:{center:16744703,support:16744703}};constructor(t){const e=t.clientWidth,i=t.clientHeight;if(this.#v=t.getContext("2d"),this.#x=new a(e,i),!this.#v||!this.#x)throw new TypeError("argument error in StockChart.constructor.");this.#y=i-110,this.#A=i-10,this.#E=i-90}get mode(){return this.#C}set mode(t){this.#C=t,t==r.PRICE_MODE?(this.#_(),this.#F(this.#v)):(this.#N(),this.#O(this.#v))}get averageCost(){return this.#P}get nowPrice(){return this.#D[0][4]}dateData(t,e){const i=this.#b;let s=this.#T-(t/i|0)-1;s<0&&(s=0);const h=this.#D[s],a=this.#M[s],o=this.#C==r.PRICE_MODE;return{date:h[0].join("/"),open:o?n(h[1]):a[0]/100+"%",high:o?n(h[2]):a[1]/100+"%",low:o?n(h[3]):a[2]/100+"%",close:o?n(h[4]):a[3]/100+"%",volume:n(h[5]),line:o?this.#H(e,this.#f,this.#L):this.#H(e,this.#I,this.#V)/100+"%"}}setData(t,e,i=0){for(const e of t)e[0]=e[0].split("-");(e|=0)>t.length&&(e=t.length);let s=Number.MAX_VALUE,h=Number.MIN_VALUE,a=0;for(let i=0;i<e;++i){const e=t[i][2],n=t[i][3],r=t[i][5];n<s&&(s=n),e>h&&(h=e),r>a&&(a=r)}let n=Number.MAX_VALUE,r=Number.MIN_VALUE,o=t[e-1][4],l=[[0,0,0,0]];for(let i=e-2;i>=0;--i){const e=t[i][4],s=[1e4*(t[i][1]/o-1)|0,1e4*(t[i][2]/o-1)|0,1e4*(t[i][3]/o-1)|0,1e4*(e/o-1)|0];s[1]>r&&(r=s[1]),s[2]<n&&(n=s[2]),l.push(s),o=e}this.#f=s,this.#L=h,this.#P=i,this.#b=this.#x.width/e,this.#S=a,this.#D=t,this.#T=e,this.#I=n,this.#V=r,this.#M=l.reverse(),this.#_(),this.#F(this.#v)}#$(t,e,a){this.#x.clear();const n=this.#D,r=this.#T;let o=0;const l=this.#b;let d=n[r-1][0][1];for(let t=r-1;t>=0;--t){const e=n[t][0][1];e!=d&&(this.#x.drawLine(o,0,o,this.#x.height,this.#q.monthlySeparator),d=e),o+=l}this.#x.drawLine(0,t,this.#x.width,t,this.#q.horizonLine),this.#x.drawLine(0,e,this.#x.width,e,this.#q.horizonLine),this.#x.drawLine(0,this.#A,this.#x.width,this.#A,this.#q.horizonLine),this.#x.drawLine(0,this.#E,this.#x.width,this.#E,this.#q.horizonLine);const c=(this.#A-this.#E)/2+this.#E;this.#x.drawLine(0,c-25,this.#x.width,c-25,this.#q.RSI.support),this.#x.drawLine(0,c,this.#x.width,c,this.#q.RSI.center),this.#x.drawLine(0,c+25,this.#x.width,c+25,this.#q.RSI.support),o=0;for(let t=r-1;t>=0;--t)this.#k(o,l,n[t][5]),o+=l;o=0;const p=new i(5),m=new i(25),g=new s(14),u=new h(.02);let w=0,C=0,v=0;for(let t=r+25;t>=0;--t){if(t>=n.length)continue;const e=n[t][4],i=l/2+o;if(a){if(p.push(e)){const e=a(p.calc());w>0&&t<r-1&&this.#x.drawLine(i-l,w,i,e,this.#q.MA[0]),w=e}if(m.push(e)){const e=a(m.calc());C>0&&t<r-1&&this.#x.drawLine(i-l,C,i,e,this.#q.MA[1]),C=e}const s=a(u.calc(n[t][2],n[t][3],e));t<r-1&&this.#x.drawRect(o+1,s-1,l-2,3,u.getTrend()?this.#q.parabolic.up:this.#q.parabolic.down)}if(g.push(e)){const e=this.#x.height-g.value;t<r-1&&this.#x.drawLine(i-l,v,i,e,this.#q.RSI.line),v=e}t>r-1||(o+=l)}}#B(t){this.#x.rectAlpha(0,0,50,this.#x.height,.25),t.putImageData(this.#x.imageData,0,0),t.fillStyle="#"+this.#q.text.toString(16),t.fillText(n(this.#S),0,this.#E);const e=this.#x.width,i=this.#D,s=this.#T,h=this.#b;let a=0,r=i[s-1][0][1];for(let n=s-1;n>=0;--n){const s=i[n][0];if(s[1]!=r&&(t.fillText(` ${s[0]}/${0|s[1]}`,a,this.#y+10),r=s[1]),a+=h,a>=e-64)break}}#_(){const t=t=>this.#W(t,this.#f,this.#L);if(this.#$(t(this.#f),t(this.#L),t),this.#P>this.#f&&this.#P<this.#L){const e=t(this.#P);this.#x.drawLine(0,e,this.#x.width,e,this.#q.averageCost)}const e=this.#b,i=this.#L-this.#f;let s=0;for(let h=this.#T-1;h>=0;--h){const a=this.#D[h];this.#z(s,e,a[1],a[2],a[3],a[4],t,i),s+=e}}#F(t){const e=t=>this.#W(t,this.#f,this.#L);this.#B(t),t.fillStyle="#"+this.#q.text.toString(16),t.fillText(n(this.#f),0,e(this.#f)),t.fillText(n(this.#L),0,e(this.#L)),this.#P>this.#f&&this.#P<this.#L&&t.fillText(n(this.#P),0,e(this.#P))}#N(){const t=t=>this.#W(t,this.#I,this.#V);this.#$(t(this.#I),t(this.#V));const e=t(0),i=t(500),s=t(-500);this.#x.drawLine(0,e,this.#x.width,e,this.#q.rate.center),this.#x.drawLine(0,i,this.#x.width,i,this.#q.rate.support),this.#x.drawLine(0,s,this.#x.width,s,this.#q.rate.support);const h=this.#b,a=this.#V-this.#I;let n=0;for(let e=this.#T-1;e>=0;--e){const i=this.#M[e];this.#z(n,h,i[0],i[1],i[2],i[3],t,a),n+=h}}#O(t){const e=t=>this.#W(t,this.#I,this.#V);this.#B(t),t.fillStyle="#"+this.#q.text.toString(16),t.fillText(this.#I/100+"%",0,e(this.#I)),t.fillText(this.#V/100+"%",0,e(this.#V)),t.fillText("0%",0,e(0)),this.#V>500&&t.fillText("5%",0,e(500)),this.#I<500&&t.fillText("-5%",0,e(-500))}#W(t,e,i){const s=i-e,h=this.#R,a=this.#y-h;return a-(t-e)/s*a+h|0}#H(t,e,i){const s=this.#R,h=i-e;return h-(t-s)/(this.#y-s)*h+e|0}#z(t,e,i,s,h,a,n,r){const o=i<a,l=n(o?a:i),d=(e/2|0)+(0|t);let c=Math.abs(a-i)/r*(this.#y-this.#R)|0;c<=0&&(c=1);const p=o?this.#q.candle.up:this.#q.candle.down;this.#x.drawLine(d,n(h),d,n(s),p),this.#x.drawRect(t,l,e,c,p)}#k(t,e,i){const s=i/this.#S*(this.#A-this.#E-1)|0;s<=0||this.#x.drawRect(t,this.#A-s,e,s,this.#q.volume)}}const o=(t,e)=>{const i=document.createElement(t);return e&&(i.className=e),i};class l{#U={};#G={};#X=null;constructor(t){let e=+t.dataset.chartWidth,i=+t.dataset.chartHeight,s=+t.dataset.dateRange;s||(s=180),e||(e=5*s),i||(i=480),"static"==getComputedStyle(t).position&&(t.style.position="relative"),this.#U.parent=t,this.#U.header=this.#j(),this.#U.chart=this.#Y(e,i);const h=getComputedStyle(this.#U.chart).zIndex;this.#U.overlay=this.#Z(h),this.#G.dateRange=s,t.appendChild(this.#U.header),t.appendChild(this.#U.chart),t.appendChild(this.#U.overlay.line),t.appendChild(this.#U.overlay.data),t.addEventListener("mouseenter",(t=>this.#J(t.clientX,t.clientY))),t.addEventListener("mousemove",(t=>this.#K(t.clientX,t.clientY))),t.addEventListener("mouseleave",(t=>this.#Q(t.clientX,t.clientY)))}updateName(t){const e=this.#U.header.querySelector(".name");t instanceof HTMLElement?(e.textContent="",e.appendChild(t)):e.textContent=t}updateChart(t,e){this.#X=new r(this.#U.chart),this.#X.setData(t,this.#G.dateRange,e);const i=this.#X.nowPrice;return this.#tt(i),e>0&&this.#et(i,e),i}#j(){const t=o("div","header");return t.appendChild(this.#it()),t.appendChild(o("span","name")),t.appendChild(o("span","price")),t.appendChild(o("span","delta")),t}#it(){const t=o("div","changeMode");return t.textContent="株価チャート",t.style.display="inline-block",t.onclick=()=>{this.#X&&(this.#X.mode==r.PERCENTAGE_CHANGE_MODE?(t.textContent="株価チャート",this.#X.mode=r.PRICE_MODE):(t.textContent="騰落率チャート",this.#X.mode=r.PERCENTAGE_CHANGE_MODE))},t}#Y(t,e){const i=o("canvas");return i.width=t,i.height=e,i}#Z(t){const e=o("div","overlay line"),i=o("div","overlay data");e.style.display=i.style.display="none",e.style.position=i.style.position="absolute",e.style.zIndex=i.style.zIndex=`${t+1}`,e.style.borderBottom="solid 1px black";const s=(t,e)=>{const i=document.createDocumentFragment(),s=o("dt");return s.textContent=t,i.appendChild(s),i.appendChild(o("dd",e)),i},h=o("dl");return h.appendChild(s("日付","date")),h.appendChild(s("始値","open")),h.appendChild(s("高値","high")),h.appendChild(s("安値","low")),h.appendChild(s("終値","close")),h.appendChild(s("出来高","volume")),i.appendChild(h),{line:e,data:i}}#tt(t){this.#U.header.querySelector(".price").textContent=`：${n(t)}円`}#et(t,e){const i=t-e,s=(100*(t/e-1)).toFixed(3),h=this.#U.header.querySelector(".delta");var a;h.classList.toggle("plus",i>0),h.classList.toggle("minus",i<0),h.textContent=`(${a=i,(a>0?"+":"")+n(a)}円 ${(t=>(t>0?"+":"")+t)(s)}%)`}#J(t,e){const i=0|this.#U.chart.getBoundingClientRect().width,s=this.#U.overlay.data,h=this.#U.overlay.line;s.style.position="absolute",s.style.display="block",h.style.width=`${i}px`,h.style.position="absolute",h.style.display="block"}#K(t,e){if(!this.#X)return;const i=this.#U.chart.getBoundingClientRect(),s=0|i.width,h=0|i.height,a=t-(0|i.left),n=e-(0|i.top);if(!(a>=0&&a<s&&n>=0&&n<h))return void this.#Q(t,e);const r=this.#U.overlay.data,o=this.#U.overlay.line;"none"==r.style.display&&this.#J(t,e),r.style.left=`${a}px`,r.style.top=`calc(${n}px + 2rem)`;const l=this.#X.dateData(a,n);r.querySelector(".date").textContent=l.date,r.querySelector(".open").textContent=l.open,r.querySelector(".high").textContent=l.high,r.querySelector(".low").textContent=l.low,r.querySelector(".close").textContent=l.close,r.querySelector(".volume").textContent=l.volume,o.style.top=`${n}px`,o.textContent=l.line}#Q(t,e){const i=this.#U.overlay.data,s=this.#U.overlay.line;i.style.display="none",s.style.display="none"}}var d=e.Z;export{d as default};